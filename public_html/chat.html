<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Chat!</title>
    <link rel="stylesheet" type="text/css" href="style.css" />
    <script src="moment.js"></script>
    <script type="text/javascript">
        var ws;
        document.addEventListener('keydown', enterSendMessage);
        function init() {
            ws = new WebSocket("ws://192.168.1.178:80/chat");
            userNameField = "${username}";
            ws.onopen = function (event) {
            }
            ws.onmessage = function (event) {
                var now = moment(new Date()).format('DD-MM-YYYY HH:mm:ss');
                var messageHead = now + "\n";
                showMessage(event.data, messageHead)
            }
            ws.onclose = function (event) {

            }
        };

        function sendMessage() {
            var messageField = document.getElementById("message");
            if(0 != messageField.value.length) {
                var message = messageField.value;
                ws.send(message);
                messageField.value = '';
            }
            return false;
        }

        function enterSendMessage(event) {
            if ((event.keyCode == 10 || event.keyCode == 13) && event.ctrlKey) {
                sendMessage();
                return true;
            }
            return false;
        }

        function showMessage(message, messageHeadValue) {
            var messageBox = document.createElement('div');
            messageBox.classList.add('messageBox')

            var messageHead = document.createElement('div');
            messageHead.classList.add('messageHead');

            var messageHeadTime = document.createElement('div');
            messageHeadTime.classList.add('messageHeadTime');
            messageHeadTime.appendChild(document.createTextNode(messageHeadValue));

            var messageUser = document.createElement('div');
            messageUser.classList.add('messageHeadUserName');
            messageUser.appendChild(document.createTextNode(userNameField));

            messageHead.append(messageHeadTime, messageUser);

            messageBox.appendChild(messageHead);

            var messageElem = document.createElement('div');
            messageElem.classList.add('messageValue');
            messageElem.appendChild(document.createTextNode(message));

            messageBox.appendChild(messageElem);

            document.getElementById('chatbox').appendChild(messageBox);

            messageBox.scrollIntoView();
        }
    </script>
</head>
    <body onload="init();">
    <div id="container">
        <div id="menu">
            <h2>Welcome, ${username}</h2>
            <div id="users" class="usersBlock"></div>
        </div>

        <div id="content">
            <div id="messages" class="messageBlock">
                <div id="chatbox"></div>
            </div>
            <div id="messageInput" class="messageInput">
                <form name="messageForm" action="" class="messageForm" onsubmit="return sendMessage()">
                    <textarea name="usermsg" id="message" class="messageInputTextArea" onkeypress="enterSendMessage()"></textarea>
                    <input type="button" name="submitmsg" value="Send" class="messageInputSend" onclick="sendMessage()"/>
                </form>
            </div>
        </div>

        <div id="clear"></div>
    </div>

    </body>
</html>